## Day11

### Elio

#### ✈️ 내용 정리

#### 렌더링 패턴

#### 렌더링 패턴의 중요성

뛰어난 사용자 경험을 제공하기 위해서는 아래 사항 충족 필요

- CWV와 같은 사용자 중심 지표로 최적화
- 빠른 빌드 시간
- 낮은 서버 비용
- 동적 콘텐츠
- 쉬운 롤백
- 안정적인 가동 시간
- 확장 가능한 인프라

렌더링 패턴을 사용하면 이러한 기대사항 중 대부분을 충족 가능

#### 클라이언트 사이드 렌더링

- 대부분의 애플리케이션 로직이 클라이언트에서 실행
- 새로고침 없이 탐색을 지원해 뛰어난 사용자 경험 제공
- 페이지의 복잡성이 증가하면 FCP, TTI를 증가시킴
- 웹사이트 SEO에 부정적인 영향

#### 서버 사이드 렌더링

- 사용자 요청에 대한 응답으로 렌더링할 페이지 콘텐츠의 전체 HTML을 서버에서 생성
- 개인 맞춤형 데이터를 포함하는 페이지에 가장 적합

- SSR을 사용하면 CSR에 비해 데이터 fetching 및 템플릿 처리를 위한 왕복 시간을 줄일 수 있음
- 핵심 원칙은 HTML을 서버에서 렌더링하고 클라이언트에서 다시 하이드레이션하는데 필요한 자바스크립트를 제공
- 하이드레이션에는 비용이 따르기 때문에 SSR은 하이드레이션 최적화에 집중

#### 정적 렌더링

- 정적 렌더링은 전체 페이지의 HTML을 빌드 시점에 미리 생성하며, 다음 빌드 때까지 변경되지 않음
- CDN이나 엣지 네트워크에 쉽게 캐싱될 수 있어 페이지 응답 시간을 줄일 수 있음
- 자주 변경되지 않고 누가 요청하든 동일한 데이터를 표시하는 페이지에 적합

##### 점진적 정적 생성(ISR)

- 정적 렌더링과 SSR을 결합한 방식으로, 특정 정적 페이지만 미리 렌더링하고 동적 페이지는 사용자 요청 시에 on-demand 방식으로 렌더링
- 빌드 후 기존 정적 사이트에 점진적으로 업데이트를 적용하기 위해 두 가지 측면에서 작동
  - 새로운 페이지 추가 허용
  - 기존 페이지 업데이트
    - 각 페이지에 적절한 타임아웃을 정의하고, 시간이 경과할 때마다 페이지가 다시 유효한지 체크

##### On-demand ISR

- 일반 ISR과 달리 정해진 시간 간격이 아니라 특정 이벤트 발생 시에 페이지가 재생성됨
- 항상 최신 상태를 유지하면서도 합리적인 비용으로 빠르고 동적인 웹사이트를 운영할 수 있음

#### 스트리밍 SSR

- SSR이나 정적 렌더링은 자바스크립트 용량을 줄여 페이지가 상호작용 가능해지는 시간을 FCP에 더 가깝게 만들 수 있음
- 스트리밍 SSR은 TTI와 FCP를 더욱 단축 가능
- 현재 페이지에 필요한 마크업을 작은 조각으로 나눠서 전송
- 네트워크 정체 현상에 효과적

#### 엣지 SSR

- CDN의 모든 지역에서 서버 렌더링을 가능하게 하고, 콜드 부트(함수가 처음 실행될 때 발생하는 지연 시간)을 거의 0에 가깝게 줄여줌
- 서버리스 함수를 사용하면 전체 페이지를 서버 사이드에서 생성 가능
- 엣지 런타임은 HTTP 스트리밍도 지원해 준비되는 즉시 문서의 일부를 스트리밍하고 각 컴포넌트를 세밀하게 하이드레이션하여 FCP 시간을 단축
- 사용자별로 지역 특화 리스트 페이지 생성 가능

#### 하이브리드 렌더링

- 어떤 상황에서든 최적인 결과를 제공하기 위해 여러 가지 렌더링 방식을 결합

#### 점진적 하이드레이션

- 각 노드를 시간에 따라 개별적으로 하이드레이션하여 필요한 최소한의 자바스크립트만 요청하는 방식
- 완전한 점진적 하이드레이션 구현
  - 모든 컴포넌트에 SSR 사용 가능
  - 개별 컴포넌트 또는 조각 단위로 코드 스플리팅 지원
  - 개발자가 정의한 순서대로 클라이언트 사이드에서 각 조각 별 하이드레이션 지원
  - 이미 하이드레이션된 조각에서 사용자 입력 가능 상태 유지
  - 지연된 하이드레이션이 적용되는 조각에 로딩중임을 표시
- 리액트의 동시성 모드로 위 요구사항 충족 가능

#### 아일랜드 아키텍쳐

- 정적인 HTML 위에 독립적으로 전달될 수 있는 상호작용 아일랜드를 통해 자바스크립트의 전송량을 줄이는 패러다임
- 대부분의 페이지는 정적 콘텐츠와 동적 콘텐츠가 결합된 형태로, 정적 콘텐츠 위에 상호작용 영역이 구분 가능하게 흩어져 있는 형태로 구성
- 동적인 부분은 HTML과 스크립트가 결합되어 렌더링 후 스스로 하이드레이션 할 수 있는 능력을 갖추고 있음
- 점진적 하이드레이션과 혼동될 수 있지만 점진적 하이드레이션은 구조가 하향식
- 페이지가 개별 컴포넌트를 제어하지만 아일랜드 아키텍쳐에서는 각 컴포넌트가 스스로를 제어
- 장점
  - 성능
  - SEO
  - 중요 콘텐츠 우선순위
  - 접근성
  - 컴포넌트 기반
- 단점
  - 직접 아키텍처 개발 필요
  - 사용자와의 상호작용이 활발한 애플리케이션의 경우 아일랜드 아키텍처는 적합하지 않음

#### 리액트 서버 컴포넌트

- 서버에서 실행되도록 설계된 상태를 가지지 않는 리액트 컴포넌트
- 번들 크기를 0으로 줄이고, 서버 컴포넌트와 클라이언트 컴포넌트 사이의 매끄러운 코드 전환 경험, 니팅을 가능케 함
- SSR 방식과 차별화되며 클라이언트 사이드 번들을 줄일 수 있음



#### 👀 인사이트

### Dennis

#### ✈️ 내용 정리

렌더링 패턴의 중요성
- 주어진 상황에 가장 적합한 렌더링 패턴을 선택하는 것은 개발 경험과 최종 사용자 경험에 엄청난 차이를 만들 수 있다.
- 뛰어난 UX를 제공하기 위해선, CWV(Core Web Vitals) 지표를 기준으로 애플리케이션을 최적화해야 한다.
  - CWV 지표
    - TTFB (Time To First Byte)
      - 클라이언트가 페이지 콘텐츠의 첫 번째 파이트를 받는데 걸리는 시간
    - FCP (First Contentful Paint)
      - 페이지 이동 후 브라우저가 콘텐츠의 첫 부분을 렌더링하는 데 걸리는 시간
    - TTI (Time to Interactive)
      - 페이지 로드 시작부터 사용자 입력에 빠르게 응답할 수 있을때까지 걸리는 시간
    - LCP (Largest Contentful Paint)
      - 페이지의 주요 콘텐츠를 로드하고 렌더링하는 데  걸리는 시간
    - CLS (Cumulative Layout Shift)
      - 예상치 못한 레이아웃 변겨을 방지하기 위한 시각적 안정성 측정
    - FID (First Input Delay)
      - 사용자가 페이지와 상호작용한 시점부터 이벤트 핸들러가 실행될 수 있는 시점까지의 시간
- CWV 지표는 사용자 경험과 관련 높은 요소들을 측정하기 때문에 최적화하면 뛰어난 사용자 경험과 검색 엔진 최적화(SEO)를 보장할 수 있음

클라이언트 사이드 렌더링 (CSR)
- 특징
  - 대부분의 애플리케이션 로직이 클라이언트에서 실행
  - 데이터를 가져오거나 저장하기 위한 API 호출로 서버와 상호작용
  - 사용자의 인터렉션에 따라 페이지 이동 시 새로운 요청을 서버로 보내지 않음
  - 이미지 표시, 데이터 저장소에서 데이터 가져오기, 이벤트 처리등 페이지의 복잡성이 증가하면 JS 코드 복잡성와 크기 증가


서버 사이드 렌더링 (SSR)
- 특징
  - 가장 오래된 웹 콘텐츠 렌더링 방식 중 하나
  - 사용자의 요청에 대한 응답으로 렌더링 할 페이지 콘텐츠의 전체 HTML 을 서버에서 생성
  - 모든 요청이 독립적으로 처리되고, 서버에 의해서 새로운 요청으로 간주됨
  - 데이터 fetching 및 템플릿 처리를 위한 추가적인 왕복 시간을 줄일 수 있음
  - SSR의 핵심 원칙은 HTML을 서버에서 렌더링하고 클라이언트에서 다시 하이드레이션
    
정적 렌더링 (SR)
- 특징
  - 전체 페이지의 HTML을 빌드 시점에서 미리 생성
  - CDN이나 엣지 네트워크에 쉽게 캐싱 가능
  - 정적 렌더링 방식은 자주 변경되지 않고 누가 요청하든 동일하든 동일한 데이터를 표시하는 페이지에 가장 적합 
  - 보통 블로그나 뉴스같은 변하지 않는 게시물을 보여줄 때 사용

점진적 정적 생성(ISR)
- 특징
  - 점진적 정적 생성은 정적 렌더링과 SSR이 결합한 방식으로, 특정 정적 페이지만 미리 렌더링하고 동적 페이지는 사용자 요청시에 on-Demand 방식으로 렌더링
  - 빌드시간 단축 및 **특정 시간 마다 캐시를 자동으로 무효화**하고 페이지를 다시 재생성 할 수 있음
  - 새로운 페이지 생성 시 지연 로딩을 사용하여 fallback 페이지나 로딩 화면을 보여줌
  - 기존 페이지 업데이트 시 적절한 타임아웃 시간을 지정하고 시간이 경과할 때마다 페이지가 다시 유효한지 검증함
    - 따라서 ISR은 Stale - While - Revalidate 전략을 사용함
    - 재검증은 백그라운드에서 이루어지며 애플리케이션 전체 재빌드가 필요하지 않음

On-Demand ISR
- 일반 ISR과 달리, 정해진 시간 간격이 아니라 **특정 이벤트 발생 시에 페이지가 재생성** 됨
- 일반 ISR
  - 시간주기로 페이지가 재생성됨
  - 사용자의 요청을 처리한 엣지 네티워크 노드에만 캐시됨
- On-demand ISR
  - 엣지 네트워크 전체에 페이지를 다시 생성하고 재분배
  - 자동으로 전 세계 사용자가 캐시된 오래된 콘텐츠가 아닌 최신 버전의 페이지를 볼 수 있음
  - 불필요한 페이지 재생성과 서버리스 함수 호출을 피할 수 있어 비용 절감

스트리밍 SSR
- 현재 페이지에 필요한 마크업을 모두 담은 큰 HTML 파일 하나를 생성하는 대신에 작은 조각 (chunk)로 나누어 전송
- Node.js의 스트림 기능을 사용하여 응답 객체에 데이터를 스트리밍 할 수 있는데 이를 통해 구현
- 리액트에서는 내장된 `renderToNodeStream` 함수를 사용하여 애플리케이션을 작은 조각으로 나누어 전달할 수 있음
- 네트워크 정체 현상에 효과적임
  - 네티워크가 혼잡하다면 렌더러는 신호를 받아 스트리밍을 중단할 수 있음

엣지 SSR
- CDN의 모든 지역에서 서버 렌더링을 가능하게 하고 콜드 부트를 0에 가깝게 줄여줌
- 서버리스 함수를 사용하여 전체 페이지를 서버 사이드에서 생성
- 엣지 런타임은 HTTP 스트리밍도 지원
- 활용 사례로는 사용자별 지역 특화 리스트 페이지를 구축하는것을 예로 들 수 있음
  - 페이지의 대부분이 정적 컨텐츠이고 리스트 부분만 외부 요청으로 데이터를 가져올때, 전체 페이지를 서버 렌더링하는 대신 리스트 컴포넌트만 서버 사이드에서 렌더링하고 나머지는 엣지 사이드에서 렌더링하도록 선택 가능

하이브리드 렌더링
- 다양한 렌더링 전략을 조합하여 사용
- 애플리케이션을 렌더링하는 다양한 전략 (예: ISR, SSR, CSR 등등)을 조합하여 사용
- 더이상 SPA와 MAP로 분류될 필요가 없다.
- 하이브리드 렌더링을 지원하는 프레임워크
  - Next.js 13
    - 리액트 서버 컴포넌트와 App Router 를 사용하여 하이브리딩 렌더링
  - Astro 2.0
    - SSG와 SSR 중 하나를 선택하는 대신, 정적 렌더링과 동적 렌더링의 장점을 모두 활용
  - Angular Universal 11.1
    - 네이티브 하이브리드 렌더링을 지원하며, 정적 경로에는 사전 정적 렌더링을, 동적 경로에는 SSR을 수행함
  - Nuxt 3.0
    - 하이브리드 렌더링을 지원하기 위한 라우팅 규칙을 설정할 수 있음

점진적 하이드레이션
- 각 노드를 시간에 따라 개별적으로 하이드레이션 하여 필요한 최소한 자바스크립트만 요청하는 방식
- 흔히 발생하는 서버에서 렌더링된 DOM 트리가 파괴되고 즉시 다시 생성되는 문제를 방지 가능
- 점진적 하이드레이션 구현을 위한 요구사항
  - 모든 컴포넌트에 SSR 사용 가능
  - 개별 컴포넌트 또는 조각 단위로 코드 스플리팅 지원
  - 개발자가 정의한 순서대로 클라이언트 사이드에서 각 조각 별 하이드레이션 지원
  - 이미 하이드레이션 조각에서 사용자 입력 가능 상태 유지
  - 지연된 하이드레이션이 적용되는 조각에 로딩 중임을 표시 가능

아일랜드 아키텍처
- 정적인 HTML 위에 독립적으로 전달될 수 있는 상호작용 아일랜드를 통해 자바스크립트의 전송량을 줄이는 패러다임
- 컴포넌트 기반의 아키텍처
- 정적 아일랜드, 동적 아일랜드로 구분된 페이지 뷰 제안
- 대부분의 페이지는 정적 콘텐츠와 동적 콘텐츠가 결합된 형대로, 정적 콘텐츠 위에 상호작용 영역이 구분 가능하게 흩어져 있는 형태로 구성
- 정적인 부분은 하이드레이션 필요 X
- 동적인 부분은 렌더링 후 스스로 하이드레이션 하는 능력 보유
- 점진적 하이드레이션과 차이점
  - 점진적 하이드레이션 : 전체 페이지에서 개별 컴포넌트 스케줄링 및 하이드레이션 제어
  - 아일랜드 아키텍처 : 각 컴포넌트가 자체적으로 하이드레이션 스크립트를 가지고 있음, 페이지의 다른 스크립트와 **독립적**으로 비동기 실행
- 도입 시 이점
  - 성능
    - 클라이언트에 전송되는 자바스크립트 코드의 양이 줄어들면서 페이지 로드 속도는 자연스럽게 빨라짐
  - SEO
    - 모든 정적 콘텐츠가 서버에서 렌더링 되므로 검색 엔진 최적화에 유리
  - 중요 컨텐츠 우선순위
    - 블로그, 뉴스 기사 등 핵심 콘텐츠를 사용자가 즉시 확인 가능
  - 접근성
    - 표준 정적 HTML 링크를 사용하여 다른 페이지에 접근함으로 접근성 향상
  - 컴포넌트 기반
    - 재사용성과 유지보수 용이성과 같은 컴포넌트 기반 아키텍처의 모든 이점을 제공

리액트 서버 컴포넌트(RSC)
- 서버에서 실행되도록 설계된, 상태를 가지지 않는 리액트 컴포넌트
- 서버 컴포넌트와 클라이언트 컴포넌트 사이에 불필요한 의존성을 분할하게 되면서 번들 사이즈 감소


#### 👀 인사이트
